{% extends 'templates/main.html' %}

{% block title %}Add Document{% endblock %}

{% block head %}
<style>
.label {
  width: 80px;
  display: inline-block;

}
</style>
{% endblock %}

{% block content %}
{%if customDocType%}
{%set customDocTypeUrl = '/' + customDocType %}
{%endif%}
 <form name="myForm" action="{{context|safe}}/document/add{{customDocTypeUrl}}" method="post">
    <input type="hidden" name="folderId" value="{{folderId}}"/>
    {%if doc._id%}
    <input type="hidden" name="_id" value="{{doc._id.toString()}}"/>
    {%endif%}
    <div>
      <label>Name:
        <input type="text" name="name" placeholder="name" value="{{doc.name}}" />
      </label>
    </div>
    {%if isFolder%}
    <input type="hidden" name="docType" value="folder"/>
    
    {%else%}

    <input type="hidden" name="docType" value="{{doc.docType}}"/>

    {%for editable in modelEditables%}
    {%if editable.name != 'name'%}
     {%if editable.type == 'text' %}
        {%set itemValue = doc[editable.name]%}

         <div><label>{{editable.label}}:
          <input type="text" name="{{editable.name}}" placeholder="{{editable.label}}" value="{{itemValue}}"/>
          </label>
        </div>

      {%elif  editable.type == 'date'%}
        {%set itemValue = doc[editable.name] + ''%}

         <div><label>{{editable.label}}:
          <input type="text" name="{{editable.name}}" placeholder="{{editable.label}}" value="{{itemValue}}"/>
          </label>
        </div>

      {%elif  editable.type == 'file'%}
       <div><label>{{editable.label}}:
        <textarea name="{{editable.name}}" placeholder="{{editable.label}}" style="width: 100%; height: 400px;">{%set fileItem = doc['content']%}{%if fileItem%}{{fileItem.toString('utf8')}}{%endif%}</textarea>
        </label>
      </div>
      {%endif%}
    {%endif%}
    {%endfor%}

    {# 
    <div><label>Route:
      <input type="text" name="route" placeholder="route" value="{{doc.route}}"/>
      </label>
    </div>

    <div><label>Controller:
      <input type="text" name="controller" placeholder="controller" value="{{doc.controller}}"/>
      </label>
    </div>

    <div><label>Content:
      <textarea name="content" placeholder="content" style="width: 100%; height: 400px;">{{doc.content.toString('utf8')}}</textarea>
      </label>
    </div>
    #}

    {%endif%}
    <a class="tiny secondary button" href="{{context|safe}}/document/list?folderId={{folderId}}">Cancel</a>
    

    {%if doc._id%}
    <input class="tiny button" type="submit" value="Update"/>
    <a href="{{context|safe}}/document/delete/{{doc._id.toString()|urlencode}}" class="tiny button alert" style="float: right;">Delete</a>
    {%else%}
    <input class="tiny button" type="submit" value="Add"/>
    {%endif%}

    
  </form>

{% endblock %}


{% block beforeEndBody %}
<script>
function bindEvent(element, type, handler) {
   if(element.addEventListener) {
      element.addEventListener(type, handler, false);
   } else {
      element.attachEvent('on'+type, handler);
   }
}

bindEvent(window, 'load', function() {
  document.myForm.name.select();
});
</script>
{% endblock %}